WITH count_table AS
(SELECT CASE WHEN grade IN ('V6-V7', 'V6') THEN 'V6' 
  WHEN grade IN ('V7-V8', 'V7') THEN 'V7'
  ELSE grade END AS grade_,
  COUNT(strftime("%Y", date_)) AS count_
FROM dataframe
GROUP BY grade_
ORDER BY grade_),

hover_info AS
(SELECT CASE WHEN grade IN ('V6-V7', 'V6') THEN 'V6' 
  WHEN grade IN ('V7-V8', 'V7') THEN 'V7'
  ELSE grade END AS grade_,
  date_,
  grade,
  location,
  setter,
  LOWER(wall_type) AS wall_type,
  LOWER(hold_type) AS hold_type,
  LOWER(style) AS style,
  description,
  LOWER(color) AS color
FROM dataframe
GROUP BY grade_
HAVING MIN(date_)
ORDER BY date_)

SELECT c.grade_, c.count_,
  h.date_,
  h.grade,
  h.location,
  h.setter,
  h.wall_type,
  h.hold_type,
  h.style,
  h.description,
  color
FROM count_table c
LEFT JOIN hover_info h
ON c.grade_=h.grade_
ORDER BY h.date_
;
